<group name="kubernetes,threat_hunting,k8s_audit,">

  <!-- Base tag rule (optional but useful for grouping) -->
  <rule id="100001" level="3">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <description>Kubernetes audit event (base)</description>
    <group>k8s_audit,</group>
  </rule>

  <!-- Pod exec -->
  <rule id="100010" level="12">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <field name="data.verb">create</field>
    <field name="data.objectRef.subresource">exec</field>
    <description>Kubernetes pod exec detected</description>
    <mitre><id>T1059</id></mitre>
    <options>no_full_log</options>
    <group>k8s_audit,interactive_access,</group>
  </rule>

  <!-- Port-forward -->
  <rule id="100011" level="10">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <field name="data.verb">create</field>
    <field name="data.objectRef.subresource">portforward</field>
    <description>Kubernetes port-forward detected</description>
    <options>no_full_log</options>
    <group>k8s_audit,interactive_access,</group>
  </rule>

  <!-- Namespace deletion -->
  <rule id="100020" level="13">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <field name="data.verb">delete</field>
    <field name="data.objectRef.resource">namespaces</field>
    <description>Kubernetes namespace deleted</description>
    <mitre><id>T1485</id></mitre>
    <group>k8s_audit,impact,</group>
  </rule>

  <!-- RBAC changes (broad) -->
  <rule id="100030" level="12">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <field name="data.objectRef.apiGroup">rbac.authorization.k8s.io</field>
    <description>Kubernetes RBAC object modified</description>
    <mitre><id>T1098</id></mitre>
    <group>k8s_audit,rbac,privilege_escalation,</group>
  </rule>

  <!-- RBAC high-risk: clusterrolebindings create/patch/update -->
  <rule id="100031" level="15">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <field name="data.objectRef.apiGroup">rbac.authorization.k8s.io</field>
    <field name="data.objectRef.resource">clusterrolebindings</field>
    <regex field="data.verb">^(create|patch|update)$</regex>
    <description>High-risk RBAC change: clusterrolebinding create/patch/update</description>
    <mitre><id>T1098</id></mitre>
    <group>k8s_audit,rbac,privilege_escalation,high_risk,</group>
  </rule>

  <!-- Secrets access -->
  <rule id="100040" level="10">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <field name="data.objectRef.resource">secrets</field>
    <regex field="data.verb">^(get|list|watch)$</regex>
    <description>Kubernetes secrets accessed</description>
    <mitre><id>T1552</id></mitre>
    <group>k8s_audit,credential_access,</group>
  </rule>

  <!-- Anonymous access -->
  <rule id="100045" level="14">
    <if_matched_sid>kubernetes_audit</if_matched_sid>
    <field name="data.user.username">system:anonymous</field>
    <description>Kubernetes anonymous API access detected</description>
    <group>k8s_audit,authentication,</group>
  </rule>

</group>
